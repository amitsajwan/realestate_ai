"""
Complete Real Estate Agent Journey Demo
======================================

This demo shows the full agent experience from onboarding to daily operations:

1. Agent Registration & Profile Setup
2. Facebook Integration & Page Setup  
3. Lead Generation & Capture
4. CRM Dashboard Overview
5. Lead Management & Follow-ups
6. AI-Powered Insights & Recommendations
7. Performance Analytics
8. Mobile Experience

Run this demo to see the complete agent journey in action!
"""

import asyncio
import json
import time
from datetime import datetime, timedelta
from typing import Dict, List, Any
import random
from uuid import uuid4

# Import our existing components
import test_db_setup
from repositories.crm_repository import CRMRepository
from models.crm import Lead, LeadStatus, LeadSource, LeadInteraction, InteractionType, InteractionDirection, LeadScore, PropertyInterest
from quick_dashboard_implementation import generate_quick_dashboard_data

class AgentJourneyDemo:
    """Complete agent journey demonstration."""
    
    def __init__(self):
        self.agent_profile = None
        self.crm_repo = None
        self.leads_created = []
        self.interactions_logged = []
        
    async def initialize_demo(self):
        """Initialize the demo environment."""
        print("üöÄ Initializing Real Estate Agent Journey Demo...")
        print("=" * 60)
        
        # Setup database
        redis_client = await test_db_setup.get_test_redis_pool()
        self.crm_repo = CRMRepository(redis_client)
        
        print("‚úÖ Database initialized")
        print("‚úÖ CRM repository ready")
        print("‚úÖ Demo environment prepared")
        
    async def step_1_agent_onboarding(self):
        """Step 1: Agent Registration & Profile Setup"""
        print("\n" + "="*60)
        print("üìù STEP 1: AGENT ONBOARDING & PROFILE SETUP")
        print("="*60)
        
        # Create agent profile
        self.agent_profile = {
            "agent_id": str(uuid4()),  # Generate proper UUID
            "name": "Priya Sharma",
            "email": "priya.sharma@mumbaiproperties.com",
            "phone": "+91 98765 43210",
            "location": "Mumbai, Maharashtra",
            "specialization": ["Residential", "Commercial", "Luxury"],
            "areas_covered": ["Bandra", "Andheri", "Juhu", "Powai", "Lower Parel"],
            "languages": ["English", "Hindi", "Marathi"],
            "experience_years": 5,
            "certifications": ["RERA Certified", "Real Estate Professional"],
            "profile_completed": True,
            "onboarding_date": datetime.now().isoformat()
        }
        
        print(f"üë§ Agent Profile Created:")
        print(f"   Name: {self.agent_profile['name']}")
        print(f"   Location: {self.agent_profile['location']}")
        print(f"   Specialization: {', '.join(self.agent_profile['specialization'])}")
        print(f"   Areas: {', '.join(self.agent_profile['areas_covered'])}")
        print(f"   Languages: {', '.join(self.agent_profile['languages'])}")
        print(f"   Experience: {self.agent_profile['experience_years']} years")
        
        # Simulate onboarding checklist completion
        onboarding_steps = [
            "‚úÖ Personal information completed",
            "‚úÖ Professional credentials verified", 
            "‚úÖ Service areas defined",
            "‚úÖ Pricing structure configured",
            "‚úÖ Marketing preferences set",
            "‚úÖ Mobile app installed"
        ]
        
        print(f"\nüìã Onboarding Progress:")
        for step in onboarding_steps:
            print(f"   {step}")
            await asyncio.sleep(0.5)  # Simulate real-time completion
            
        print(f"\nüéâ Agent onboarding completed successfully!")
        return True
        
    async def step_2_facebook_integration(self):
        """Step 2: Facebook Integration & Page Setup"""
        print("\n" + "="*60)
        print("üìò STEP 2: FACEBOOK INTEGRATION & PAGE SETUP")
        print("="*60)
        
        # Simulate Facebook page connection
        facebook_setup = {
            "page_id": "mumbai_properties_priya",
            "page_name": "Priya Sharma - Mumbai Properties",
            "page_url": "facebook.com/mumbaiproperties.priya",
            "followers": 1250,
            "page_verified": True,
            "business_account": True,
            "lead_ads_enabled": True,
            "messenger_enabled": True,
            "whatsapp_connected": True
        }
        
        print(f"üìò Facebook Page Connected:")
        print(f"   Page: {facebook_setup['page_name']}")
        print(f"   URL: {facebook_setup['page_url']}")
        print(f"   Followers: {facebook_setup['followers']:,}")
        print(f"   Verified: {'‚úÖ' if facebook_setup['page_verified'] else '‚ùå'}")
        print(f"   Lead Ads: {'‚úÖ' if facebook_setup['lead_ads_enabled'] else '‚ùå'}")
        print(f"   Messenger: {'‚úÖ' if facebook_setup['messenger_enabled'] else '‚ùå'}")
        print(f"   WhatsApp: {'‚úÖ' if facebook_setup['whatsapp_connected'] else '‚ùå'}")
        
        # Create sample Facebook ad campaigns
        campaigns = [
            {
                "name": "Bandra Luxury Apartments",
                "budget": "‚Çπ5,000/day",
                "targeting": "Age 28-45, Income ‚Çπ15L+, Location: Bandra 5km",
                "status": "Active",
                "leads_generated": 23
            },
            {
                "name": "First-Time Home Buyers",
                "budget": "‚Çπ3,000/day", 
                "targeting": "Age 25-35, Income ‚Çπ8L+, Location: Mumbai",
                "status": "Active",
                "leads_generated": 18
            },
            {
                "name": "Investment Properties",
                "budget": "‚Çπ4,000/day",
                "targeting": "Age 35-55, High Income, Investment Interest",
                "status": "Active", 
                "leads_generated": 15
            }
        ]
        
        print(f"\nüì¢ Active Ad Campaigns:")
        for campaign in campaigns:
            print(f"   üìä {campaign['name']}")
            print(f"      Budget: {campaign['budget']}")
            print(f"      Leads: {campaign['leads_generated']}")
            print(f"      Status: {campaign['status']}")
            
        print(f"\n‚úÖ Facebook marketing setup complete!")
        return facebook_setup
        
    async def step_3_lead_generation(self):
        """Step 3: Lead Generation & Capture in Real-Time"""
        print("\n" + "="*60)
        print("üéØ STEP 3: REAL-TIME LEAD GENERATION & CAPTURE")
        print("="*60)
        
        # Simulate leads coming from different sources
        lead_sources = [
            {"source": LeadSource.FACEBOOK_MESSAGE, "weight": 40},
            {"source": LeadSource.WHATSAPP, "weight": 30},
            {"source": LeadSource.WEBSITE, "weight": 20},
            {"source": LeadSource.REFERRAL, "weight": 8},
            {"source": LeadSource.PHONE_CALL, "weight": 2}
        ]
        
        # Sample lead data for Mumbai market
        sample_leads = [
            {
                "name": "Rajesh Patel",
                "phone": "+91 98765 12345",
                "email": "rajesh.patel@gmail.com",
                "location": "Bandra West",
                "budget": "‚Çπ2.5 Cr",
                "property_type": "3 BHK Apartment",
                "timeline": "Immediate"
            },
            {
                "name": "Anjali Mehta", 
                "phone": "+91 98765 67890",
                "email": "anjali.mehta@yahoo.com",
                "location": "Andheri East",
                "budget": "‚Çπ1.8 Cr",
                "property_type": "2 BHK Apartment", 
                "timeline": "3 months"
            },
            {
                "name": "Vikram Singh",
                "phone": "+91 98765 11111",
                "email": "vikram.singh@hotmail.com", 
                "location": "Powai",
                "budget": "‚Çπ3.2 Cr",
                "property_type": "4 BHK Villa",
                "timeline": "6 months"
            },
            {
                "name": "Kavita Joshi",
                "phone": "+91 98765 22222",
                "email": "kavita.joshi@gmail.com",
                "location": "Juhu",
                "budget": "‚Çπ5.0 Cr", 
                "property_type": "Penthouse",
                "timeline": "1 year"
            },
            {
                "name": "Arjun Reddy",
                "phone": "+91 98765 33333", 
                "email": "arjun.reddy@gmail.com",
                "location": "Lower Parel",
                "budget": "‚Çπ2.0 Cr",
                "property_type": "Commercial Office",
                "timeline": "Immediate"
            }
        ]
        
        print("üì± Simulating real-time lead capture...")
        print("   (Watch leads come in from different sources)")
        print()
        
        for i, lead_data in enumerate(sample_leads):
            # Select random source based on weights
            source = random.choices(
                [s["source"] for s in lead_sources],
                weights=[s["weight"] for s in lead_sources]
            )[0]
            
            # Create lead score
            score_value = random.randint(75, 95)
            lead_score = LeadScore(
                score=score_value,
                confidence=random.uniform(0.7, 0.95),
                factors={
                    "budget_match": "High" if lead_data["budget"] != "‚Çπ5.0 Cr" else "Very High",
                    "location_preference": "Good",
                    "timeline_urgency": "High" if lead_data["timeline"] == "Immediate" else "Medium",
                    "communication_responsiveness": "Good"
                },
                recommendations=[
                    "Call within 1 hour for best response rate",
                    "Share property portfolio matching budget",
                    "Schedule property viewing"
                ]
            )
            
            # Create property interest
            property_interest = PropertyInterest(
                property_type=lead_data["property_type"],
                budget_max=float(lead_data["budget"].replace("‚Çπ", "").replace(" Cr", "").replace(",", "")) * 10000000,
                location=lead_data["location"],
                urgency=lead_data["timeline"].lower(),
                purpose="buy"
            )
            
            # Create lead
            lead = Lead(
                id=uuid4(),
                agent_id=self.agent_profile["agent_id"],
                name=lead_data["name"],
                phone=lead_data["phone"],
                email=lead_data["email"],
                source=source,
                status=LeadStatus.NEW,
                score=lead_score,
                property_interest=property_interest,
                initial_message=f"Interested in {lead_data['property_type']} in {lead_data['location']}. Budget: {lead_data['budget']}. Timeline: {lead_data['timeline']}.",
                created_at=datetime.now(),
                updated_at=datetime.now()
            )
            
            # Save to CRM
            await self.crm_repo.create_lead(lead)
            self.leads_created.append(lead)
            
            # Show real-time notification
            source_emoji = {
                LeadSource.FACEBOOK_MESSAGE: "üìò",
                LeadSource.WHATSAPP: "üí¨", 
                LeadSource.WEBSITE: "üåê",
                LeadSource.REFERRAL: "üë•",
                LeadSource.PHONE_CALL: "üìû"
            }
            
            print(f"üîî NEW LEAD ALERT!")
            print(f"   {source_emoji.get(source, 'üìã')} Source: {source.value}")
            print(f"   üë§ Name: {lead.name}")
            print(f"   üìç Location: {lead.property_interest.location if lead.property_interest else 'Not specified'}")
            print(f"   üí∞ Budget: ‚Çπ{lead.property_interest.budget_max/10000000:.1f} Cr" if lead.property_interest and lead.property_interest.budget_max else "Budget not specified")
            print(f"   üè† Type: {lead.property_interest.property_type if lead.property_interest else 'Not specified'}")
            print(f"   ‚≠ê Score: {lead.score.score if lead.score else 0}/100")
            print(f"   üì± Phone: {lead.phone}")
            print()
            
            await asyncio.sleep(2)  # Simulate real-time delay
            
        total_leads = len(self.leads_created)
        print(f"üìä Lead Generation Summary:")
        print(f"   Total leads captured: {total_leads}")
        print(f"   Average lead score: {sum(l.score.score for l in self.leads_created if l.score) / total_leads:.1f}/100")
        print(f"   Sources breakdown:")
        
        source_count = {}
        for lead in self.leads_created:
            source_count[lead.source] = source_count.get(lead.source, 0) + 1
            
        for source, count in source_count.items():
            percentage = (count / total_leads) * 100
            print(f"     {source.value}: {count} leads ({percentage:.1f}%)")
            
        return self.leads_created
        
    async def step_4_crm_dashboard(self):
        """Step 4: CRM Dashboard Overview"""
        print("\n" + "="*60)
        print("üìä STEP 4: CRM DASHBOARD OVERVIEW")
        print("="*60)
        
        # Generate dashboard data
        dashboard_data = await generate_quick_dashboard_data(self.agent_profile["agent_id"])
        
        print("üì± Agent Dashboard - Live View:")
        print()
        
        # Display key metrics
        metrics = dashboard_data["basic_metrics"]
        print("üéØ KEY PERFORMANCE METRICS:")
        print(f"   üìà Total Leads: {metrics['total_leads']}")
        print(f"   ‚≠ê New Today: {metrics['new_today']}")  
        print(f"   üî• Hot Leads: {metrics['hot_leads']}")
        print(f"   ‚è∞ Follow-ups Due: {metrics['follow_ups_due']}")
        print(f"   üìÖ Meetings Today: {metrics['meetings_today']}")
        print(f"   üíº Deals Closing: {metrics['deals_closing']}")
        print(f"   üì± Response Rate: {metrics['response_rate']}")
        print(f"   ‚ö° Avg Response Time: {metrics['avg_response_time']}")
        print()
        
        # Lead source breakdown
        sources = dashboard_data["lead_sources"]
        print("üìä LEAD SOURCE PERFORMANCE:")
        for source, count in sources.items():
            percentage = (count / sum(sources.values())) * 100
            bar = "‚ñà" * min(int(percentage / 3), 20)
            print(f"   {source.title():<12} {count:>3} leads ‚îÇ{bar:<20}‚îÇ {percentage:>5.1f}%")
        print()
        
        # Pipeline status
        pipeline = dashboard_data["pipeline"]
        print("üîÑ SALES PIPELINE:")
        stages = ["new", "qualified", "meeting", "proposal", "negotiation", "closed"]
        for stage in stages:
            count = pipeline.get(stage, 0)
            stage_name = stage.replace("_", " ").title()
            value = f"‚Çπ{count * 25000:,}" if count > 0 else "‚Çπ0"
            print(f"   {stage_name:<12} {count:>3} deals ‚îÇ {value}")
        print()
        
        # Weekly trend
        weekly = dashboard_data["weekly_trend"]
        print("üìà WEEKLY LEAD TREND:")
        for day_data in weekly:
            day = day_data["day"]
            count = day_data["count"]
            bar = "‚ñì" * min(count, 15)
            print(f"   {day} ‚îÇ{bar:<15}‚îÇ {count} leads")
        print()
        
        return dashboard_data
        
    async def step_5_lead_management(self):
        """Step 5: Lead Management & Follow-ups"""
        print("\n" + "="*60)
        print("üìû STEP 5: LEAD MANAGEMENT & FOLLOW-UPS")
        print("="*60)
        
        print("üìã Priya's Daily Lead Management Workflow:")
        print()
        
        # Prioritize hot leads
        hot_leads = [lead for lead in self.leads_created if lead.score and lead.score.score >= 85]
        warm_leads = [lead for lead in self.leads_created if lead.score and 70 <= lead.score.score < 85]
        
        print(f"üî• HIGH PRIORITY - Hot Leads ({len(hot_leads)} leads, score 85+):")
        for lead in hot_leads[:3]:  # Show top 3
            print(f"   üìû CALL NOW: {lead.name}")
            location = lead.property_interest.location if lead.property_interest else "Not specified"
            budget = f"‚Çπ{lead.property_interest.budget_max/10000000:.1f} Cr" if lead.property_interest and lead.property_interest.budget_max else "Budget not specified"
            property_type = lead.property_interest.property_type if lead.property_interest else "Not specified"
            score = lead.score.score if lead.score else 0
            print(f"      üìç {location} ‚îÇ üí∞ {budget} ‚îÇ ‚≠ê {score}/100")
            print(f"      üè† Looking for: {property_type}")
            print()
            
            # Simulate interaction
            interaction = LeadInteraction(
                id=uuid4(),
                lead_id=lead.id,
                agent_id=self.agent_profile["agent_id"],
                type=InteractionType.CALL,
                message=f"Initial call to {lead.name}. Discussed {property_type} requirements in {location}. Very interested, scheduling property visit.",
                channel="phone",
                direction=InteractionDirection.OUTBOUND,
                was_successful=True,
                created_at=datetime.now()
            )
            
            # Note: Using create_lead method for now, adjust based on actual repository
            # await self.crm_repo.create_interaction(interaction)
            self.interactions_logged.append(interaction)
            
            # Update lead status
            await self.crm_repo.update_lead(lead.id, {"status": LeadStatus.CONTACTED})
            
            print(f"   ‚úÖ Call completed - Meeting scheduled")
            print(f"   üìù Notes: {interaction.message}")
            print(f"   üìÖ Next action: Property showing on weekend")
            print()
            
        print(f"üå°Ô∏è MEDIUM PRIORITY - Warm Leads ({len(warm_leads)} leads, score 70-84):")
        for lead in warm_leads[:2]:  # Show top 2
            location = lead.property_interest.location if lead.property_interest else "Not specified"
            budget = f"‚Çπ{lead.property_interest.budget_max/10000000:.1f} Cr" if lead.property_interest and lead.property_interest.budget_max else "Budget not specified"
            score = lead.score.score if lead.score else 0
            print(f"   üí¨ WhatsApp follow-up: {lead.name}")
            print(f"      üìç {location} ‚îÇ üí∞ {budget} ‚îÇ ‚≠ê {score}/100")
            
            # Simulate WhatsApp message
            interaction = LeadInteraction(
                id=uuid4(),
                lead_id=lead.id,
                agent_id=self.agent_profile["agent_id"],
                type=InteractionType.MESSAGE,
                message=f"WhatsApp message sent to {lead.name} with property options in {location}. Shared brochures and pricing details.",
                channel="whatsapp",
                direction=InteractionDirection.OUTBOUND,
                was_successful=True,
                created_at=datetime.now()
            )
            
            # Note: Using create_lead method for now, adjust based on actual repository
            # await self.crm_repo.create_interaction(interaction)
            self.interactions_logged.append(interaction)
            
            print(f"   ‚úÖ WhatsApp sent - Property details shared")
            print()
            
        # Show follow-up schedule
        print("üìÖ TODAY'S FOLLOW-UP SCHEDULE:")
        follow_ups = [
            {"time": "10:00 AM", "lead": "Rajesh Patel", "action": "Property visit - Bandra apartment"},
            {"time": "2:00 PM", "lead": "Anjali Mehta", "action": "Call - Discuss financing options"},
            {"time": "4:30 PM", "lead": "Vikram Singh", "action": "Send villa comparisons"},
            {"time": "6:00 PM", "lead": "Kavita Joshi", "action": "Penthouse viewing appointment"}
        ]
        
        for follow_up in follow_ups:
            print(f"   ‚è∞ {follow_up['time']} - {follow_up['lead']}")
            print(f"      üìã {follow_up['action']}")
            
        print(f"\nüìä Lead Management Summary:")
        print(f"   üìû Calls made: {len([i for i in self.interactions_logged if i.type == InteractionType.CALL])}")
        print(f"   üí¨ Messages sent: {len([i for i in self.interactions_logged if i.type == InteractionType.MESSAGE])}")
        print(f"   üìÖ Meetings scheduled: {len(hot_leads)}")
        print(f"   ‚è∞ Follow-ups pending: {len(warm_leads)}")
        
        return self.interactions_logged
        
    async def step_6_ai_insights(self):
        """Step 6: AI-Powered Insights & Recommendations"""
        print("\n" + "="*60)
        print("ü§ñ STEP 6: AI-POWERED INSIGHTS & RECOMMENDATIONS")
        print("="*60)
        
        print("üß† AI Assistant Analysis for Priya Sharma:")
        print()
        
        # Performance insights
        insights = [
            {
                "category": "üéØ Lead Conversion",
                "insight": "Your Facebook leads convert 34% better than WhatsApp leads",
                "recommendation": "Increase Facebook ad budget by ‚Çπ2,000/day",
                "impact": "Expected +8 quality leads/week",
                "confidence": "87%"
            },
            {
                "category": "‚è∞ Timing Optimization", 
                "insight": "Leads contacted within 5 minutes have 67% higher response rate",
                "recommendation": "Enable instant mobile notifications for new leads",
                "impact": "Expected +23% conversion rate",
                "confidence": "92%"
            },
            {
                "category": "üìç Geographic Focus",
                "insight": "Bandra leads have 2.3x higher close rate this month",
                "recommendation": "Prioritize Bandra property listings and marketing",
                "impact": "Expected +‚Çπ12L revenue/month",
                "confidence": "78%"
            },
            {
                "category": "üí¨ Communication Channel",
                "insight": "WhatsApp follow-ups get 45% more responses than calls",
                "recommendation": "Use WhatsApp for initial follow-ups, calls for qualified leads",
                "impact": "Expected +15% engagement",
                "confidence": "85%"
            },
            {
                "category": "üí∞ Pricing Strategy",
                "insight": "Leads with ‚Çπ2-3Cr budget close fastest (avg 21 days)",
                "recommendation": "Focus marketing on mid-luxury segment",
                "impact": "Expected faster deal closure",
                "confidence": "81%"
            }
        ]
        
        for insight in insights:
            print(f"{insight['category']}")
            print(f"   üí° Insight: {insight['insight']}")
            print(f"   üéØ Recommendation: {insight['recommendation']}")
            print(f"   üìà Impact: {insight['impact']}")
            print(f"   üé≤ Confidence: {insight['confidence']}")
            print()
            
        # Market intelligence
        print("üìä MUMBAI MARKET INTELLIGENCE:")
        market_data = {
            "avg_price_bandra": "‚Çπ45,000/sq ft",
            "market_trend": "+8% YoY growth",
            "inventory_levels": "Low (buyer's market)",
            "best_selling": "3 BHK apartments",
            "avg_days_to_sell": "45 days",
            "price_prediction": "+12% next 6 months"
        }
        
        print(f"   üè† Avg price (Bandra): {market_data['avg_price_bandra']}")
        print(f"   üìà Market trend: {market_data['market_trend']}")
        print(f"   üì¶ Inventory: {market_data['inventory_levels']}")
        print(f"   üî• Best selling: {market_data['best_selling']}")
        print(f"   ‚è±Ô∏è Days to sell: {market_data['avg_days_to_sell']}")
        print(f"   üîÆ Prediction: {market_data['price_prediction']}")
        print()
        
        # Smart recommendations for today
        print("üí° SMART ACTIONS FOR TODAY:")
        smart_actions = [
            "üìû Call Rajesh Patel before 11 AM (highest pickup probability)",
            "üí¨ Send Anjali WhatsApp with 2 BHK options in Andheri",
            "üìß Email Vikram villa comparison sheet with ROI analysis", 
            "üìÖ Schedule Kavita's penthouse viewing for weekend",
            "üì± Post Bandra apartment on Facebook (peak engagement time: 7 PM)"
        ]
        
        for i, action in enumerate(smart_actions, 1):
            print(f"   {i}. {action}")
            
        return insights
        
    async def step_7_performance_analytics(self):
        """Step 7: Performance Analytics & Reporting"""
        print("\n" + "="*60)
        print("üìà STEP 7: PERFORMANCE ANALYTICS & REPORTING")
        print("="*60)
        
        # Calculate performance metrics
        total_leads = len(self.leads_created)
        total_interactions = len(self.interactions_logged)
        contacted_leads = len([l for l in self.leads_created if l.status == LeadStatus.CONTACTED])
        
        conversion_rate = (contacted_leads / total_leads * 100) if total_leads > 0 else 0
        avg_score = sum(l.score.score for l in self.leads_created if l.score) / total_leads if total_leads > 0 else 0
        
        print("üìä PRIYA'S PERFORMANCE DASHBOARD:")
        print()
        
        # Key metrics
        print("üéØ KEY METRICS (This Week):")
        metrics = [
            ("Total Leads", f"{total_leads}", "üìà +23% vs last week"),
            ("Conversion Rate", f"{conversion_rate:.1f}%", "üìà +5.2% vs last week"),
            ("Avg Lead Score", f"{avg_score:.1f}/100", "üìà +3.1 vs last week"),
            ("Response Time", "4.2 min", "üìà -18% vs last week"),
            ("Meetings Scheduled", f"{len([i for i in self.interactions_logged if i.message and 'meeting' in i.message.lower()])}", "üìà +67% vs last week"),
            ("Revenue Pipeline", "‚Çπ15.2 Cr", "üìà +31% vs last week")
        ]
        
        for metric, value, trend in metrics:
            print(f"   {metric:<18} {value:<10} {trend}")
        print()
        
        # Weekly comparison
        print("üìÖ WEEKLY PERFORMANCE TREND:")
        weeks = ["Week 1", "Week 2", "Week 3", "Week 4 (Current)"]
        weekly_data = [
            {"leads": 12, "conversions": 8, "revenue": "‚Çπ8.5Cr"},
            {"leads": 18, "conversions": 12, "revenue": "‚Çπ11.2Cr"},
            {"leads": 22, "conversions": 16, "revenue": "‚Çπ13.8Cr"},
            {"leads": 28, "conversions": 21, "revenue": "‚Çπ15.2Cr"}
        ]
        
        for week, data in zip(weeks, weekly_data):
            progress = "üìà" if data["leads"] > 15 else "üìä"
            print(f"   {week:<15} ‚îÇ {data['leads']:>2} leads ‚îÇ {data['conversions']:>2} conv ‚îÇ {data['revenue']}")
        print()
        
        # Source performance
        print("üìä LEAD SOURCE ROI ANALYSIS:")
        source_performance = [
            {"source": "Facebook Ads", "cost": "‚Çπ12,000", "leads": 18, "cpl": "‚Çπ667", "quality": "High"},
            {"source": "WhatsApp", "cost": "‚Çπ0", "leads": 12, "cpl": "‚Çπ0", "quality": "Very High"},
            {"source": "Website", "cost": "‚Çπ3,000", "leads": 8, "cpl": "‚Çπ375", "quality": "Medium"},
            {"source": "Referrals", "cost": "‚Çπ2,000", "leads": 4, "cpl": "‚Çπ500", "quality": "Very High"}
        ]
        
        for perf in source_performance:
            print(f"   {perf['source']:<12} ‚îÇ Cost: {perf['cost']:<8} ‚îÇ Leads: {perf['leads']:>2} ‚îÇ CPL: {perf['cpl']:<8} ‚îÇ Quality: {perf['quality']}")
        print()
        
        # Goals tracking
        print("üéØ MONTHLY GOALS TRACKING:")
        goals = [
            {"goal": "Lead Generation", "target": 100, "achieved": 75, "progress": 75},
            {"goal": "Conversion Rate", "target": 25, "achieved": 28, "progress": 112},
            {"goal": "Revenue", "target": 50, "achieved": 42, "progress": 84},
            {"goal": "Client Satisfaction", "target": 90, "achieved": 94, "progress": 104}
        ]
        
        for goal in goals:
            progress_bar = "‚ñà" * min(int(goal["progress"] / 5), 20)
            status = "‚úÖ" if goal["progress"] >= 100 else "üîÑ"
            print(f"   {status} {goal['goal']:<18} ‚îÇ{progress_bar:<20}‚îÇ {goal['progress']:>3}%")
        print()
        
        # Awards and achievements
        print("üèÜ ACHIEVEMENTS & RECOGNITION:")
        achievements = [
            "ü•á Top Performer - Mumbai Region (Q3 2025)",
            "‚≠ê 5-Star Customer Rating (94% satisfaction)",
            "üìà Highest Conversion Rate - Bandra Division",
            "üí¨ WhatsApp Marketing Excellence Award",
            "üéØ Lead Quality Champion (88% avg score)"
        ]
        
        for achievement in achievements:
            print(f"   {achievement}")
            
        return {
            "total_leads": total_leads,
            "conversion_rate": conversion_rate,
            "avg_score": avg_score,
            "performance_trend": "Excellent"
        }
        
    async def step_8_mobile_experience(self):
        """Step 8: Mobile Experience Demo"""
        print("\n" + "="*60)
        print("üì± STEP 8: MOBILE EXPERIENCE DEMO")
        print("="*60)
        
        print("üì≤ Priya's Mobile CRM Experience:")
        print("   (Optimized for field agents working on-the-go)")
        print()
        
        # Mobile dashboard
        print("üì± MOBILE DASHBOARD - Quick View:")
        print("‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê")
        print("‚îÇ  üè† Mumbai Properties - Priya       ‚îÇ")
        print("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§")
        print("‚îÇ  üìä Today's Summary                 ‚îÇ")
        print("‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ")
        print("‚îÇ  üìà 5 New Leads    üî• 3 Hot         ‚îÇ")
        print("‚îÇ  üìû 2 Calls Due    üìÖ 1 Meeting     ‚îÇ")
        print("‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§")
        print("‚îÇ  üöÄ Quick Actions                   ‚îÇ")
        print("‚îÇ  ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ  ‚îÇ")
        print("‚îÇ  [üìû Call Hot Leads    ]            ‚îÇ")
        print("‚îÇ  [üí¨ Send WhatsApp     ]            ‚îÇ")
        print("‚îÇ  [üìÖ Schedule Meeting  ]            ‚îÇ")
        print("‚îÇ  [üìç Add Property      ]            ‚îÇ")
        print("‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò")
        print()
        
        # Mobile notifications
        print("üîî MOBILE NOTIFICATIONS (Real-time):")
        notifications = [
            "üîî New lead: Amit Kumar - ‚Çπ2.8Cr budget (2 min ago)",
            "üìû Reminder: Call Rajesh Patel at 2:00 PM",
            "üí¨ WhatsApp: Anjali replied to your message",
            "üìç GPS: You're near Vikram's preferred location",
            "‚è∞ Meeting in 30 min: Kavita Joshi - Penthouse viewing"
        ]
        
        for notification in notifications:
            print(f"   {notification}")
        print()
        
        # Location-based features
        print("üìç LOCATION-BASED FEATURES:")
        print("   üì± GPS Integration:")
        print("   Current Location: Bandra West")
        print("   üìç Nearby Properties: 12 listings within 2km")
        print("   üè† Scheduled Visits: 1 property (Rajesh Patel)")
        print("   üöó Navigation: 'Get Directions' to next appointment")
        print()
        
        # Voice commands
        print("üé§ VOICE COMMANDS (Hands-free operation):")
        voice_commands = [
            '"Hey CRM, show me today\'s hot leads"',
            '"Add note to Rajesh Patel: Very interested in 3BHK"',
            '"Schedule call with Anjali for tomorrow 3 PM"',
            '"What\'s my conversion rate this week?"',
            '"Show properties near Bandra under 3 crores"'
        ]
        
        for command in voice_commands:
            print(f"   üé§ {command}")
        print()
        
        # Offline capabilities
        print("üì¥ OFFLINE CAPABILITIES:")
        print("   ‚úÖ View lead details and contact info")
        print("   ‚úÖ Add notes and interactions")
        print("   ‚úÖ Schedule follow-ups and meetings")
        print("   ‚úÖ Take property photos and videos")
        print("   ‚úÖ Auto-sync when connection restored")
        print()
        
        # Touch-optimized interface
        print("üëÜ TOUCH-OPTIMIZED INTERFACE:")
        print("   üì± Large buttons for finger-friendly navigation")
        print("   üìä Swipe gestures for quick chart navigation")
        print("   üìû One-tap calling and messaging")
        print("   üì∏ Quick photo capture for property updates")
        print("   üîÑ Pull-to-refresh for real-time data")
        
        return True
        
    async def run_complete_demo(self):
        """Run the complete agent journey demo."""
        print("üé¨ REAL ESTATE AGENT JOURNEY - COMPLETE DEMO")
        print("=" * 60)
        print("From Onboarding to Daily Operations")
        print("Live demonstration of Priya Sharma's journey")
        print("=" * 60)
        
        try:
            # Initialize
            await self.initialize_demo()
            
            # Run all steps
            await self.step_1_agent_onboarding()
            await self.step_2_facebook_integration()
            await self.step_3_lead_generation()
            await self.step_4_crm_dashboard()
            await self.step_5_lead_management()
            await self.step_6_ai_insights()
            await self.step_7_performance_analytics()
            await self.step_8_mobile_experience()
            
            # Demo summary
            print("\n" + "="*60)
            print("üéâ DEMO COMPLETE - AGENT JOURNEY SUMMARY")
            print("="*60)
            
            print("‚úÖ JOURNEY COMPLETED SUCCESSFULLY!")
            print()
            print("üìã Demo Summary:")
            print(f"   üë§ Agent onboarded: {self.agent_profile['name']}")
            print(f"   üìò Facebook integrated: Mumbai Properties page")
            print(f"   üéØ Leads generated: {len(self.leads_created)} leads")
            print(f"   üìû Interactions logged: {len(self.interactions_logged)} interactions")
            print(f"   üìä Dashboard metrics: Real-time updates")
            print(f"   ü§ñ AI insights: 5 actionable recommendations")
            print(f"   üìà Performance tracking: All metrics green")
            print(f"   üì± Mobile experience: Fully optimized")
            print()
            
            print("üöÄ READY FOR PRODUCTION:")
            print("   ‚úÖ Complete agent onboarding flow")
            print("   ‚úÖ Real-time lead capture and management")
            print("   ‚úÖ AI-powered insights and recommendations")
            print("   ‚úÖ Comprehensive performance analytics")
            print("   ‚úÖ Mobile-first user experience")
            print("   ‚úÖ Mumbai market optimizations")
            print()
            
            print("üí° BUSINESS IMPACT:")
            print("   üìà 23% increase in lead generation")
            print("   ‚ö° 67% faster response times")
            print("   üéØ 31% improvement in conversion rate")
            print("   üí∞ ‚Çπ15.2 Cr revenue pipeline created")
            print("   ‚≠ê 94% agent satisfaction score")
            
            return True
            
        except Exception as e:
            print(f"‚ùå Demo failed: {e}")
            return False

async def main():
    """Run the complete agent journey demo."""
    import sys
    
    # Check if we want direct journey test
    if len(sys.argv) > 1 and sys.argv[1] == "--test":
        print("üé¨ Testing Complete Agent Journey (Direct Mode)")
        print("=" * 60)
        demo = AgentJourneyDemo()
        try:
            await demo.run_complete_journey()
            print("\n‚úÖ Complete Agent Journey Demo Successful!")
            print("üéâ All 8 steps executed successfully!")
        except Exception as e:
            print(f"\n‚ùå Demo failed with error: {e}")
            import traceback
            traceback.print_exc()
        return
    
    # Default: Run with web server
    demo = AgentJourneyDemo()
    success = await demo.run_complete_demo()
    
    if success:
        print("\nüé¨ DEMO PRESENTATION READY!")
        print("This comprehensive demo showcases the complete agent journey")
        print("Perfect for client presentations and stakeholder demos")
    else:
        print("\n‚ùå Demo failed to complete")

if __name__ == "__main__":
    asyncio.run(main())
